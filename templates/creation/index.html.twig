{% extends 'base.html.twig' %}

{% block title %}Hello CreationController!{% endblock %}

{% block body %}
    <h1>Emissions</h1>

    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>NOM</th>
                <th>NOMLONG</th>
                <th>DESCRIPTION</th>
                <th>IMG</th>
                <th>INSCRIPTION</th>
                <th>actions</th>
            </tr>
        </thead>
        <tbody>
        {% for emission in emissions %}
            <tr class="emission-row" data-id="{{ emission.ID }}">
                <td>{{ emission.ID }}</td>
                <td>{{ emission.NOM }}</td>
                <td>{{ emission.NOMLONG }}</td>
                <td>{{ emission.DESCRIPTION }}</td>
                <td>{{ emission.IMG }}</td>
                <td>{{ emission.INSCRIPTION ? 'Oui' : 'Non' }}</td>
                <td>
                    <!-- <a href="{{ path('app_creation_get_audios', {'ID': emission.ID}) }}">select</a>-->
                    <a href="{{ path('app_emission_show', {'ID': emission.ID}) }}">show</a>
                    <a href="{{ path('app_emission_edit', {'ID': emission.ID}) }}">edit</a>
                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="7">no records found</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <a href="{{ path('app_emission_new') }}">Create new</a>

        <h1>Audios</h1>

    <table class="table">
        <thead>
            <tr>
                <th>Id</th>
                <th>NOM</th>
                <th>DESCRIPTION</th>
                <th>HEURE</th>
                <th>DATE</th>
                <th>AUDIO</th>
                <th>AUTEURS</th>
                <th>actions</th>
            </tr>
        </thead>
        <tbody class="audios">
        </tbody>
    </table>

    <a href="{{ path('app_audio_new') }}">Create new</a>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.emission-row').forEach(row => {
                row.addEventListener('click', () => {
                    var id = row.dataset.id;

                    fetch(`/creation/${id}/audios`)
                        .then(response => response.json())
                        .then(data => {
                            var audios = document.querySelector('.audios');

                            audios.innerHTML = '';

                            if (data.length > 0) {
                                data.forEach(audio => {
                                    var tr = document.createElement('tr');

                                    tr.innerHTML = `
                                        <td>${audio.ID}</td>
                                        <td>${audio.NOM}</td>
                                        <td>${audio.DESCRIPTION}</td>
                                        <td>${audio.HEURE}</td>
                                        <td>${audio.DATE}</td>
                                        <td>${audio.AUDIO}</td>
                                        <td>${audio.AUTEURS}</td>
                                        <td>
                                            <a href="/audio/${audio.ID}">show</a>
                                            <a href="/audio/${audio.ID}/edit">edit</a>
                                        </td>
                                    `;

                                    audios.appendChild(tr);
                                });
                            } else {
                                var tr = document.createElement('tr');

                                tr.innerHTML = `
                                    <td colspan="7">no records found</td>
                                `;

                                audios.appendChild(tr);
                            }
                        })
                        .catch(error => {
                            console.log(error);
                        });
                });
            });
        });
    </script>
{% endblock %}
