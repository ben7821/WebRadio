{% extends 'base.html.twig' %}

{% block title %}Hello CreationController!
{% endblock %}

{% block body %}
	<h1 class="display-full">Emissions</h1>

	<table class="table">
		<thead>
			<tr>
				<th>ID</th>
				<th>NOM</th>
				<th>NOMLONG</th>
				<th>DESCRIPTION</th>
				<th>IMG</th>
				<th>INSCRIPTION</th>
				<th>ACTIONS</th>
			</tr>
		</thead>
		<tbody>
			{% for emission in emissions %}
				<tr class="emission-row" data-id="{{ emission.ID }}">
					<td>{{ emission.ID }}</td>
					<td>{{ emission.NOM }}</td>
					<td>{{ emission.NOMLONG }}</td>
					<td>{{ emission.DESCRIPTION }}</td>
					<td><img class="preview" src="{{asset('data/rubrique/' ~ emission.IMG)}}"/></td>
					<td>{{ emission.INSCRIPTION ? 'Oui' : 'Non' }}</td>
					<td>
						<a href="{{ path('app_emission_show', {'NOM': emission.NOM}) }}">show</a>
						<a href="{{ path('app_emission_edit', {'ID': emission.ID}) }}">edit</a>
					</td>
				</tr>
			{% else %}
				<tr>
					<td colspan="7">no records found</td>
				</tr>
			{% endfor %}
		</tbody>
	</table>

	<a href="{{ path('app_emission_new') }}" class="new_emission">NOUVELLE EMISSION</a>

    <div style="height: 5vh;"></div>

	<h1 class="display-full">Audios</h1>
	<table class="table">
		<thead>
			<tr>
				<th>Id</th>
				<th>NOM</th>
				<th>DESCRIPTION</th>
				<th>HEURE</th>
				<th>DATE</th>
				<th>AUDIO</th>
				<th>AUTEURS</th>
				<th>ACTIONS</th>
			</tr>
		</thead>
		<tbody class="audios"></tbody>
	</table>

	<a href="{{ path('app_audio_new') }}" class="new_audio">NOUVEAU AUDIO</a>

	<script>
		const newAudio = document.querySelector('.new_audio');
let selectedEmission = null;
document.addEventListener('DOMContentLoaded', () => {
document.querySelectorAll('.emission-row').forEach(row => {
row.addEventListener('click', () => {
var id = row.dataset.id;
selectedEmission = id;

fetch (`/creation/${id}/audios`).then(response => response.json()).then(data => {
var audios = document.querySelector('.audios');

audios.innerHTML = '';

if (data.length > 0) {
data.forEach(audio => {
var tr = document.createElement('tr');

tr.innerHTML = `
                                        <td>${
audio.ID
}</td>
                                        <td>${
audio.NOM
}</td>
                                        <td>${
audio.DESCRIPTION
}</td>
                                        <td>${
audio.HEURE
}</td>
                                        <td>${
audio.DATE
}</td>
                                        <td>${
audio.AUDIO
}</td>
                                        <td>${
audio.AUTEURS
}</td>
                                        <td>
                                            <a href="/audio/${
audio.ID
}">show</a>
                                            <a href="/audio/${
audio.ID
}/edit">edit</a>
                                        </td>
                                    `;

audios.appendChild(tr);
});
} else {
var tr = document.createElement('tr');

tr.innerHTML = `
                                    <td colspan="7">no records found</td>
                                `;

audios.appendChild(tr);
}
}).catch(error => {
console.log(error);
});
});
});

newAudio.addEventListener('click', (event) => {
if (selectedEmission) {
event.preventDefault();
window.location.href = `{{ path('app_audio_new')}}?emission=${selectedEmission}`;
}
});
});
	</script>
{% endblock %}
